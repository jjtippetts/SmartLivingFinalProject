<!DOCTYPE html>
<html lang="us"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Smart Living | Foods</title>

  <!-- Bootstrap CSS -->
  <link
          rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
          crossorigin="anonymous"
  />

  <!-- File css -->
  <link rel="stylesheet" href="css/style.css"/>

  <!-- Dashboard-->
  <link rel="stylesheet" href="css/dashboard.css">

  <!--Font Awesome-->
  <script
          src="https://kit.fontawesome.com/fc7f1cbe69.js"
          crossorigin="anonymous"
          SameSite="none"
  ></script>
</head>
<body>
<header class="fixed-top" th:insert="header :: header"></header>
<main>
  <div class="tab-content" id="pills-tabContent">
    <div class="tab-pane fade show active" id="pills-diet" role="tabpanel" aria-labelledby="pills-diet-tab">
      <div id="dashboard" class="container-fluid">
        <div class="row">
          <div class="col-3">
            <div id="dash-navigation" class="bg-light p-2 shadow my-3 overflow-auto">

              <div class="d-flex justify-content-between align-items-center pb-2 border-bottom">
                <p class="mb-0 font-weight-bold">Current Diet Plans</p>
                <div>
                  <button id="sync-diet-plans" class="btn btn-primary btn-sm" type="button">
                    <i class="fas fa-sync"></i>
                  </button>

                </div>
              </div>
              <div class="py-2">
                <p class="mb-0">Create a New Diet</p>
                <form id="addDietPlan" class="border-bottom d-flex justify-content-between align-items-center pb-2">
                  <div class="form-group mb-0">
                    <label for="diet-name" class="sr-only"></label>
                    <input type="text" class="form-control" id="diet-name" placeholder="Diet Name" name="name">
                  </div>
                  <button class="btn btn-primary btn-sm" type="submit">
                    <i class="fas fa-plus"></i>
                  </button>
                </form>
              </div>
              <div id="diets-found" class="pl-0 list-group list-group-flush">

              </div>
            </div>
            <div id="dash-search" class="bg-light p-2 shadow overflow-auto">
              <!--          <form id="add-food-to-meal">-->
              <!--            <legend class="mb-0">-->
              <!--              <h4 class="font-bold">Add a Food</h4>-->
              <!--            </legend>-->
              <!--            <div class="form-group">-->
              <!--              <select class="form-control" id="list-of-meals" name="meal" required>-->
              <!--                <option selected="selected" disabled="disabled" value="">Select a meal</option>-->
              <!--              </select>-->
              <!--            </div>-->
              <!--          </form>-->
              <form id="findFoodByName">
                <legend class="mb-0">
                  <h4 class="font-bold">Add a Food</h4>
                </legend>
                <div class="form-row">
                  <div class="form-group col-md-12">
                    <label for="search-food-name"></label>
                    <div class="input-group input-group">
                      <div class="input-group-prepend">
                        <button class="btn btn-outline-primary" type="submit">
                          <i class="fas fa-search"></i>
                        </button>
                      </div>
                      <input
                              type="text"
                              class="form-control"
                              id="search-food-name"
                              placeholder="Search by Name"
                              name="name"
                      />
                    </div>
                  </div>
                </div>
              </form>
              <div id="foods-found">
                <div class="list-group list-group-flush"></div>
              </div>
              <div id="selected-food-modal"></div>
            </div>
          </div>

          <div id="dash-data" class="col-9">
            <!-- Create Diet Plan -->
            <nav class="pt-3" aria-label="Page navigation example">
              <ul class="pagination justify-content-center">
                <li class="page-item">
                  <a class="page-link btn-previous" href="#" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>

                <li class="page-item">
                  <a class="page-link btn-next" href="#" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
            <div class="d-none" id="diet-slide-options">
              <ul class="nav nav-pills mb-3" id="pills-diet-tab" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" id="pills-diet-create-tab" data-toggle="pill" href="#pills-diet-create" role="tab" aria-controls="pills-diet-create" aria-selected="true">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="pills-diet-analysis-tab" data-toggle="pill" href="#pills-diet-analysis" role="tab" aria-controls="pills-diet-analysis" aria-selected="false">Profile</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="pills-diet-search-tab" data-toggle="pill" href="#pills-diet-search" role="tab" aria-controls="pills-diet-search" aria-selected="false">Contact</a>
                </li>
              </ul>
            </div>

            <div class="tab-content" id="pills-diet-tabContent">
              <div class="tab-pane fade show active" id="pills-diet-create" role="tabpanel" aria-labelledby="pills-diet-create-tab">
                <section class="bg-white">
                  <div id="diet-container">
                    <div id="diet-info"></div>
                    <div id="diet-total-nutrients"></div>
                  </div>
                </section>
              </div>
              <div class="tab-pane fade" id="pills-diet-analysis" role="tabpanel" aria-labelledby="pills-diet-analysis-tab">
                <section class="bg-white">
<!--                  <div class="row">-->
                    <div id="diet-analysis" class="col-6">
                      <canvas id="pie-chart" width="400" height="225"></canvas>
                    </div>
<!--                  </div>-->
                </section>
              </div>
              <div class="tab-pane fade" id="pills-diet-search" role="tabpanel" aria-labelledby="pills-diet-search-tab">HELLO</div>
            </div>


          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="pills-fitness" role="tabpanel" aria-labelledby="pills-fitness-tab">
      <!--BMR CALCULATOR-->
      <div class="col-4 light-gray mt-2 mb-2 rounded">
        <section class="p-2">
          <form id="BMRCalculator">
            <legend><h3>BMR Calculator</h3></legend>
            <div class="form-row">
              <div class="form-group col-6">
                <label for="feet">Feet</label>
                <input class="form-control" id="feet" type="number" min="0" name="feet" required>
              </div>
              <div class="form-group col-6">
                <label for="inches">Inches</label>
                <input class="form-control" id="inches" type="number" min="0" name="inches" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-6">
                <label for="weight">Weight</label>
                <input class="form-control" id="weight" type="number" min="0" name="weight" required>
              </div>
              <div class="form-group col-6">
                <label for="age">Age</label>
                <input class="form-control" id="age" type="number" min="0" name="age" required>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-6">
                <p class="mb-0">Gender</p>
                <div class="form-check">
                  <input class="form-check-input" id="male" type="radio" value="male" name="gender" required>
                  <label class="form-check-label" for="male">Male</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" id="female" type="radio" value="female" name="gender" required>
                  <label class="form-check-label" for="female">Female</label>
                </div>
              </div>
              <div class="form-group col-6">
                <label for="activityLevel">Activity Level</label>
                <select id="activityLevel" class="form-control custom-select">
                  <option value="1" selected="selected">Sedentary</option>
                  <option value="1.11">Low Active</option>
                  <option value="1.25">Active</option>
                  <option value="1.48">Very Active</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-6">
                <button class="btn btn-primary" type="submit">Calculate</button>
              </div>
              <div class="col-6">
                <p class="font-weight-bold">BMR: <span id="kcalResult"></span></p>
              </div>
            </div>
          </form>
        </section>
      </div>
    </div>
    <div class="tab-pane fade" id="pills-client" role="tabpanel" aria-labelledby="pills-client-tab">
      <form id="search-diet-form">
        <div class="form-group">
          <label for="search-diet">Diet ID</label>
          <input type="text" class="form-control" id="search-diet">
        </div>
        <button type="submit" class="btn btn-primary">submit</button>
      </form>
    </div>
  </div>
</main>

<!-- Bootstrap CSS -->
<!--<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
<!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.min.js"></script>-->
<!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js"></script>-->

<script
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"
></script>
<script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"
></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.0.1/mustache.min.js"></script>

<script type="text/template" id="add-food-modal">
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">{{name}}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="add-food-to-meal">
            <div class="form-group">
              <select class="form-control" id="list-of-meals" name="meal" required>
                <option selected="selected" disabled="disabled" value="">Select a meal</option>
              </select>
            </div>
          </form>
          calories: {{calories}}
          <br>
          carbs: {{carbohydrates}}
          <br>
          fat: {{fat}}
          <br>
          protein {{protein}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button id="submit-food-modal" form="add-food-to-meal" type="submit" class="btn btn-primary" >Add Food</button>
        </div>
      </div>
    </div>
  </div>
</script>


<script type="text/template" id="add-food-form">
  <tbody class='sortable'>
    <tr class="sortDisabled">
      <td>
        <form id='addMeal{{counter}}' class="addFoodToDiet">
          <button class="btn btn-primary btn-sm" type="submit">
            <i class="fas fa-plus"></i>
          </button>
        </form>
      </td>
      <td>
        <label form='addMeal{{counter}}' for='foodName{{counter}}'></label>
        <input
                form='addMeal{{counter}}'
                type="text"
                class="form-control"
                id='foodName{{counter}}'
                placeholder="Strawberries"
                name="name"
                required
        />
      </td>
      <td>
        <label form='addMeal{{counter}}' for="calories"></label>
        <input
                form='addMeal{{counter}}'
                type="number"
                min="0"
                class="form-control"
                id="calories"
                placeholder="40"
                name="calories"
                required
        />
      </td>
      <td>
        <label form='addMeal{{counter}}' for="carbohydrates"></label>
        <input
                form='addMeal{{counter}}'
                type="number"
                min="0"
                class="form-control"
                id="carbohydrates"
                placeholder="9"
                name="carbohydrates"
                required
        />
      </td>
      <td>
        <label form='addMeal{{counter}}' for="fat"></label>
        <input
                form='addMeal{{counter}}'
                type="number"
                min="0"
                class="form-control"
                id="fat"
                placeholder="0"
                name="fat"
                required
        />
      </td>
      <td>
        <label form='addMeal{{counter}}' for="protein"></label>
        <input
                form='addMeal{{counter}}'
                type="number"
                min="0"
                class="form-control"
                id="protein"
                placeholder="1"
                name="protein"
                required
        />
      </td>
    </tr>
    <tr class="sum table-info sortDisabled">
      <td>Total</td>
      <td></td>
      <td class='food-calories'>0</td>
      <td class='food-carbohydrates'>0</td>
      <td class='food-fat'>0</td>
      <td class='food-protein'>0</td>
    </tr>
  </tbody>
</script>

<script type="text/html">
  <table class="table table-striped meal">
    <thead>
      <tr class="meal-name-row table-primary">

      </tr>
    </thead>
  </table>
</script>

<script type ="text/html" id="mealNameForm">
  <th colspan="2">
    <form class='create-meal'>
      <div class='form-group row mb-0'>
        <div class='col-1'>
          <button class="btn btn-large btn-primary" type="submit">
            <i class="fas fa-plus"></i>
          </button>
        </div>
        <label for="mealName">Add a meal</label>
        <div class='col-6'>
          <input class="form-control" id="mealName" placeholder='Meal Name' type="text" name="name">
        </div>
      </div>
    </form>
  </th>
</script>

<!--Diet Analysis and graphs-->
<script src="js/dietAnalysis.js"></script>

<!--Create Diet Plan-->
<script src="js/dietPage.js"></script>

<!--On window load, load diet plan-->
<script src="js/dietPlanOnLoad.js"></script>

<script>
    $("#findFoodByName").submit(function () {
        var food = $("#search-food-name").val()
        $.getJSON("/food/" + food, function (results) {
            var list = $("#foods-found div")
            //Remove previous queries if any
            list.html("")
            $.each(results, function (index) {
                console.log(results[index])
                list.append("<a data-food-id='" + results[index].id + "' form='add-food-to-meal' class='list-group-item list-group-item-action food-found btn'>" +
                    "<h5 class='text-primary'>" +
                    "<span class = 'food-name-found'>" + results[index].name + "</span>" +
                    "</h5>" +
                    "Calories: " +
                    "<span class = 'food-calories-found'>" + results[index].calories + "</span>" +
                    " &#x25CF Carbs: " +
                    "<span class = 'food-carbs-found'>" + results[index].carbohydrates + "</span>" +
                    " &#x25CF Fat: " +
                    "<span class = 'food-fat-found'>" + results[index].fat + "</span>" +
                    " &#x25CF Protein: " +
                    "<span class = 'food-protein-found'>" + results[index].protein + "</span>" +
                    "</a>")
              JSON.stringify(results[index])
            })
            $("#search-food-name").val('')
        }).fail(function () {
            alert("ERROR");
        });

        return false
    });
</script>

<script>
    $(document).on('submit', '#BMRCalculator', function (event) {
        event.preventDefault(event)
        var age = parseInt($('#age').val())

        var feet = parseInt($('#feet').val())
        var inches = feet * 12
        inches += parseInt($('#inches').val())
        var meters = inches / 39.37
        var kg = parseInt($('#weight').val()) / 2.2

        var gender = $('input[name="gender"]:checked').val()
        var kcal = 0

        var activtyLevel = parseFloat($('#activityLevel').val())
        console.log(activtyLevel)

        if (gender === "male") {
            kcal = 662 - (9.53 * age) + activtyLevel * (15.91 * kg) + (539.6 * meters)
        } else {
            kcal = 354 - (6.91 * age) + activtyLevel * (9.36 * kg) + (726 * meters)
        }
        $("#kcalResult").text(Math.round(kcal) + " Calories")
        return false
    })
</script>

<!--Sortable Library-->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<!-- Tool Tips-->
<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>

<!--Stop buttons from staying focused-->
<script>
    $(".btn").mouseup(function () {
        $(this).blur();
    })
</script>

<!--Chart JS-->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

<script>
    var dietMacros = new Chart(document.getElementById("pie-chart"), {
        type: 'pie',
        data: {
            labels: ["carbs","fat","protein"],
            datasets: [{
                backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f"],
                data: [0,0,0]
                //"#e8c3b9","#c45850"
                // label: "Population (millions)",
                // backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
                // data: [2478,5267,734,784,433]
            }]
        },
        options: {
            title: {
                display: true,
                text: 'Diet Macros'
            },
            tooltips: {
                callbacks: {
                    label: function(tooltipItems, data) {
                        var indice = tooltipItems.index;
                        return data.datasets[tooltipItems.datasetIndex].data[indice] + 'g';
                    }
                }
            }
        }
    });
</script>

<script>
  $(document).on('submit', '#search-diet-form', function(e){
     e.preventDefault();
     var dietID = $("#search-diet").val()
      console.log(dietID)

     $.getJSON("/dietplan/" + $("#search-diet").val(), function (results) {
         console.log(results)
     })
  })
</script>


<!-- Disabled -->
<!--<script>-->
<!--    $("#viewAllFoods").click(function () {-->
<!--        $.getJSON("/food", function (results) {-->
<!--            var table = $("<table>").addClass("table");-->
<!--            var head = $("<thead>");-->
<!--            head.append('<th scope="col">Name</th>');-->
<!--            head.append('<th scope="col">Calories</th>');-->
<!--            head.append('<th scope="col">Carbohydrates</th>');-->
<!--            head.append('<th scope="col">Fat</th>');-->
<!--            head.append('<th scope="col">Protein</th>');-->
<!--            table.append(head);-->
<!--            var body = $("<tbody>");-->
<!--            $.each(results, function (index) {-->
<!--                console.log(results[index]);-->
<!--                var row = $("<tr>").addClass("aFood");-->
<!--                row.append("<td>" + results[index].name + "</td>");-->
<!--                row.append("<td>" + results[index].calories + "</td>");-->
<!--                row.append("<td>" + results[index].carbohydrates + "</td>");-->
<!--                row.append("<td>" + results[index].fat + "</td>");-->
<!--                row.append("<td>" + results[index].protein + "</td>");-->
<!--                body.append(row);-->
<!--            });-->
<!--            table.append(body);-->
<!--            $("#foodTable").append(table);-->
<!--        });-->
<!--    });-->
<!--</script>-->



</body>
</html>
