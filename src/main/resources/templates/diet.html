<!DOCTYPE html>
<html lang="us"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>Smart Living | Foods</title>

  <!-- Bootstrap CSS -->
  <link
          rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
          crossorigin="anonymous"
  />

  <!-- File css -->
  <link rel="stylesheet" href="css/style.css"/>

  <!-- Dashboard-->
  <link rel="stylesheet" href="css/dashboard.css">

  <!--Font Awesome-->
  <script
          src="https://kit.fontawesome.com/fc7f1cbe69.js"
          crossorigin="anonymous"
          SameSite="none"
  ></script>
</head>
<body>
<header class="fixed-top" th:insert="header :: header"></header>
<main>
  <div id="dashboard">
    <div class="bg-secondary position-fixed p-2" id="dash-navigation">
      <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
        <div class="pl-3 pt-3 pb-3">
          <i class="fas fa-user fa-2x"></i>
          <span class="text-white pl-3" sec:authentication="name"></span>
        </div>
        <a class="nav-link active" id="v-pills-create-tab" data-toggle="pill" href="#v-pills-create" role="tab"
           aria-controls="v-pills-create" aria-selected="true">CREATE</a>
        <a class="nav-link" id="v-pills-search-tab" data-toggle="pill" href="#v-pills-search" role="tab"
           aria-controls="v-pills-search" aria-selected="false">SEARCH</a>
        <a class="nav-link" id="v-pills-tools-tab" data-toggle="pill" href="#v-pills-tools" role="tab"
           aria-controls="v-pills-tools" aria-selected="false">TOOLS</a>
        <a class="nav-link" id="v-pills-settings-tab" data-toggle="pill" href="#v-pills-settings" role="tab"
           aria-controls="v-pills-settings" aria-selected="false">SETTINGS</a>
      </div>
    </div>
    <div id="dash-data">
      <div class="container pt-4">
        <div class="tab-content" id="v-pills-tabContent">
          <div class="tab-pane fade show active" id="v-pills-create" role="tabpanel"
               aria-labelledby="v-pills-create-tab">

            <!-- Create Diet Plan -->
            <section class="mt-3">
              <div class="d-flex flex-row align-items-center">
                <h3 class="display-4 mr-3">Create a Diet Plan</h3>
                <button type="button" class="btn btn-warning " data-toggle="tooltip" data-placement="right"
                        title="drag and drop foods to rearrange order">
                  <i class="fas fa-question"></i>
                </button>
              </div>

              <div id="create-diet-container">
                <!--Create Diet-->
                <form id="addDietPlan">
                  <div class="form-group row">
                    <label for="dietName" class="col-sm-2 col-form-label">Diet Name</label>
                    <div class="col-sm-10 col-lg-3">
                      <input id="dietName" type="text" class="form-control" placeholder="My Smart Diet" name="name"
                             required>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-10">
                      <button class="btn btn-primary" type="submit">Create</button>
                    </div>
                  </div>
                </form>
              </div>

              <div id="diet-container">
                <div id="diet-info"></div>
                <div id="diet-total-nutrients"></div>
              </div>


              <canvas id="pie-chart" width="800" height="450"></canvas>
            </section>
          </div>
          <div class="tab-pane fade" id="v-pills-search" role="tabpanel" aria-labelledby="v-pills-search-tab">
            <!-- Find food by name-->
            <section>
              <form id="findFoodByName">
                <legend>
                  <h1 class="font-bold">Search for a Food</h1>
                </legend>
                <div class="form-row">
                  <div class="form-group col-md-5">
                    <label for="search-food-name"></label>
                    <div class="input-group input-group-lg">
                      <div class="input-group-prepend">
                        <button class="btn btn-outline-primary" type="submit">
                          <i class="fas fa-search"></i>
                        </button>
                      </div>
                      <input
                              type="text"
                              class="form-control"
                              id="search-food-name"
                              placeholder="Name of Food"
                              name="name"
                      />
                    </div>
                  </div>
                </div>
<!--                <button type="submit" class="btn btn-primary">Search</button>-->
              </form>
              <div id="foods-found">
                <ul class="list-group list-group-flush"></ul>
              </div>
            </section>

            <!--View all foods-->
<!--            <section class="mt-3 mb-3">-->
<!--              <div class="">-->
<!--                <button id="viewAllFoods" type="submit" class="btn btn-primary">-->
<!--                  View All Foods-->
<!--                </button>-->
<!--              </div>-->
<!--            </section>-->

            <!--Find Diet Plans-->
<!--            <section class="mt-3 mb-3">-->
<!--              <form>-->
<!--                <legend>-->
<!--                  <h3 class="font-bold">View Diet Plans</h3>-->
<!--                </legend>-->

<!--              </form>-->
<!--            </section>-->

          </div>
          <div class="tab-pane fade" id="v-pills-tools" role="tabpanel" aria-labelledby="v-pills-tools-tab">
            <!--BMR CALCULATOR-->
            <div class="col-4 light-gray mt-2 mb-2 rounded">
              <section class="p-2">
                <form id="BMRCalculator">
                  <legend><h3>BMR Calculator</h3></legend>
                  <div class="form-row">
                    <div class="form-group col-6">
                      <label for="feet">Feet</label>
                      <input class="form-control" id="feet" type="number" min="0" name="feet" required>
                    </div>
                    <div class="form-group col-6">
                      <label for="inches">Inches</label>
                      <input class="form-control" id="inches" type="number" min="0" name="inches" required>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group col-6">
                      <label for="weight">Weight</label>
                      <input class="form-control" id="weight" type="number" min="0" name="weight" required>
                    </div>
                    <div class="form-group col-6">
                      <label for="age">Age</label>
                      <input class="form-control" id="age" type="number" min="0" name="age" required>
                    </div>
                  </div>

                  <div class="form-row">
                    <div class="form-group col-6">
                      <p class="mb-0">Gender</p>
                      <div class="form-check">
                        <input class="form-check-input" id="male" type="radio" value="male" name="gender">
                        <label class="form-check-label" for="male">Male</label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" id="female" type="radio" value="female" name="gender">
                        <label class="form-check-label" for="female">Female</label>
                      </div>
                    </div>
                    <div class="form-group col-6">
                      <label for="activityLevel">Activity Level</label>
                      <select id="activityLevel" class="form-control custom-select">
                        <option value="1" selected="selected">Sedentary</option>
                        <option value="1.11">Low Active</option>
                        <option value="1.25">Active</option>
                        <option value="1.48">Very Active</option>
                      </select>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-6">
                      <button class="btn btn-primary" type="submit">Calculate</button>
                    </div>
                    <div class="col-6">
                      <p class="font-weight-bold">BMR: <span id="kcalResult"></span></p>
                    </div>
                  </div>
                </form>
              </section>
            </div>
          </div>
          <div class="tab-pane fade" id="v-pills-settings" role="tabpanel" aria-labelledby="v-pills-settings-tab">
            <form id="search-diet-form">
              <div class="form-group">
                <label for="search-diet">Diet ID</label>
                <input type="text" class="form-control" id="search-diet">
              </div>
              <button type="submit" class="btn btn-primary">submit</button>
            </form>


          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Bootstrap CSS -->
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"
></script>
<script
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"
></script>

<script>
    $("#findFoodByID").submit(function () {
        var id = $("#foodID").val();
        $.get("/food/" + id, function (result) {
        }).fail(function () {
            alert("ERROR");
        });
        return false;
    });
</script>

<script>
    $("#viewAllFoods").click(function () {
        $.getJSON("/food", function (results) {
            var table = $("<table>").addClass("table");
            var head = $("<thead>");
            head.append('<th scope="col">Name</th>');
            head.append('<th scope="col">Calories</th>');
            head.append('<th scope="col">Carbohydrates</th>');
            head.append('<th scope="col">Fat</th>');
            head.append('<th scope="col">Protein</th>');
            table.append(head);
            var body = $("<tbody>");
            $.each(results, function (index) {
                console.log(results[index]);
                var row = $("<tr>").addClass("aFood");
                row.append("<td>" + results[index].name + "</td>");
                row.append("<td>" + results[index].calories + "</td>");
                row.append("<td>" + results[index].carbohydrates + "</td>");
                row.append("<td>" + results[index].fat + "</td>");
                row.append("<td>" + results[index].protein + "</td>");
                body.append(row);
            });
            table.append(body);
            $("#foodTable").append(table);
        });
    });
</script>

<!--Post Food-->
<script src="js/dietPage.js"></script>

<script>
    $("#findFoodByName").submit(function () {
        var food = $("#search-food-name").val()
        $.getJSON("/food/" + food, function (results) {
            var list = $("#foods-found ul")
            //Remove previous queries if any
            list.html("")
            $.each(results, function (index) {
                list.append("<li class='list-group-item'>" +
                    "<h5 class='text-primary'>" +
                    results[index].name +
                    "</h5>" +
                    "Calories: " +
                    results[index].calories +
                    " &#x25CF Carbohydrates: " +
                    results[index].carbohydrates +
                    " &#x25CF Fat: " +
                    results[index].fat +
                    " &#x25CF Protein: " +
                    results[index].protein +
                    "</li>")
              JSON.stringify(results[index])
            })
            $("#search-food-name").val('')
        }).fail(function () {
            alert("ERROR");
        });
        return false
    });
</script>

<script>
    $(document).on('submit', '#BMRCalculator', function (event) {
        event.preventDefault(event)
        var age = parseInt($('#age').val())

        var feet = parseInt($('#feet').val())
        var inches = feet * 12
        inches += parseInt($('#inches').val())
        var meters = inches / 39.37
        var kg = parseInt($('#weight').val()) / 2.2

        var gender = $('input[name="gender"]:checked').val()
        var kcal = 0

        var activtyLevel = parseFloat($('#activityLevel').val())
        console.log(activtyLevel)

        if (gender === "male") {
            kcal = 662 - (9.53 * age) + activtyLevel * (15.91 * kg) + (539.6 * meters)
        } else {
            kcal = 354 - (6.91 * age) + activtyLevel * (9.36 * kg) + (726 * meters)
        }
        $("#kcalResult").text(Math.round(kcal) + " Calories")
        return false
    })
</script>

<!--Sortable Library-->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<!-- Tool Tips-->
<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>

<!--Stop buttons from staying focused-->
<script>
    $(".btn").mouseup(function () {
        $(this).blur();
    })
</script>

//Chart JS
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>

<script>
    var dietMacros = new Chart(document.getElementById("pie-chart"), {
        type: 'pie',
        data: {
            labels: [],
            datasets: [{
                label: "Percent Macros",
                backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
                data: []
                // label: "Population (millions)",
                // backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
                // data: [2478,5267,734,784,433]
            }]
        },
        options: {
            title: {
                display: true,
                text: 'Diet Macros'
            }
        }
    });
</script>

<script>
  $(document).on('submit', '#search-diet-form', function(e){
     e.preventDefault();
     var dietID = $("#search-diet").val()
      console.log(dietID)

     $.getJSON("/dietplan/" + $("#search-diet").val(), function (results) {
         console.log(results)
     })
  })
</script>
</body>
</html>
